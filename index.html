<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EFGPJDT008"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-EFGPJDT008');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spirit Reflexes - A Magical Reaction Garden</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&family=Dancing+Script:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Kalam', cursive;
            background: linear-gradient(135deg, #E6F3FF 0%, #F0FFF0 30%, #FFFACD 70%, #FFE4E1 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }
        
        /* Floating background elements */
        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .petal {
            position: absolute;
            width: 8px;
            height: 12px;
            background: linear-gradient(45deg, #FFB6C1, #FF69B4);
            border-radius: 50% 10px 50% 10px;
            animation: floatPetal 15s infinite linear;
            opacity: 0.6;
        }
        
        @keyframes floatPetal {
            0% {
                transform: translateY(-100vh) translateX(0px) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% {
                transform: translateY(100vh) translateX(150px) rotate(360deg);
                opacity: 0;
            }
        }
        
        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #FFD700;
            border-radius: 50%;
            animation: sparkle 3s infinite ease-in-out;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
        
        .firefly {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #98FB98;
            border-radius: 50%;
            animation: firefly 8s infinite ease-in-out;
            box-shadow: 0 0 10px #98FB98;
        }
        
        @keyframes firefly {
            0%, 100% { 
                transform: translate(0, 0);
                opacity: 0.3;
            }
            25% { 
                transform: translate(100px, -50px);
                opacity: 1;
            }
            50% { 
                transform: translate(-50px, -100px);
                opacity: 0.7;
            }
            75% { 
                transform: translate(-100px, 50px);
                opacity: 1;
            }
        }
        
        /* Main container */
        .container {
            position: relative;
            z-index: 2;
            text-align: center;
            width: 90%;
            max-width: 800px;
        }
        
        /* Header */
        .header {
            margin-bottom: 40px;
        }
        
        .title {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5rem;
            color: #2F4F2F;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
            margin-bottom: 15px;
            position: relative;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #556B2F;
            font-style: italic;
            margin-bottom: 30px;
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(144, 238, 144, 0.3);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            color: #2F4F2F;
            line-height: 1.6;
        }
        
        /* Game area */
        .game-area {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border: 3px solid rgba(144, 238, 144, 0.3);
            border-radius: 30px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .game-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #90EE90, #FFB6C1, #87CEEB);
            border-radius: 30px 30px 0 0;
        }
        
        /* Reaction box */
        .reaction-box {
            width: 300px;
            height: 200px;
            border-radius: 25px;
            margin: 0 auto 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.3rem;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .reaction-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: inherit;
            border-radius: inherit;
            filter: blur(20px);
            opacity: 0.3;
            z-index: -1;
        }
        
        .reaction-box.waiting {
            background: linear-gradient(135deg, #FFB6C1, #FF69B4);
            border: 3px solid #FF1493;
            color: #8B0000;
            box-shadow: 0 10px 30px rgba(255, 20, 147, 0.3);
        }
        
        .reaction-box.ready {
            background: linear-gradient(135deg, #98FB98, #90EE90);
            border: 3px solid #228B22;
            color: #006400;
            box-shadow: 0 10px 30px rgba(34, 139, 34, 0.5);
            animation: glow 0.5s ease-in-out;
        }
        
        .reaction-box.too-early {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: 3px solid #FF8C00;
            color: #8B4513;
            box-shadow: 0 10px 30px rgba(255, 140, 0, 0.4);
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes glow {
            0% { box-shadow: 0 10px 30px rgba(34, 139, 34, 0.3); }
            50% { box-shadow: 0 15px 40px rgba(34, 139, 34, 0.8); }
            100% { box-shadow: 0 10px 30px rgba(34, 139, 34, 0.5); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .reaction-box:hover {
            transform: translateY(-5px);
        }
        
        .reaction-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .reaction-text {
            font-size: 1.1rem;
        }
        
        /* Results display */
        .results {
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid rgba(144, 238, 144, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .result-main {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2F4F2F;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .result-message {
            font-size: 1.2rem;
            color: #556B2F;
            font-style: italic;
            margin-bottom: 20px;
        }
        
        /* Statistics grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid rgba(144, 238, 144, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2F4F2F;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #556B2F;
        }
        
        /* History section */
        .history {
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid rgba(144, 238, 144, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .history-title {
            font-family: 'Dancing Script', cursive;
            font-size: 1.8rem;
            color: #2F4F2F;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .history-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        
        .history-item {
            background: linear-gradient(45deg, #98FB98, #90EE90);
            border: 1px solid rgba(34, 139, 34, 0.3);
            border-radius: 12px;
            padding: 8px 15px;
            font-weight: 600;
            color: #2F4F2F;
            font-size: 0.9rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: linear-gradient(45deg, #98FB98, #90EE90);
            border: 2px solid rgba(34, 139, 34, 0.3);
            color: #2F4F2F;
            padding: 15px 30px;
            border-radius: 25px;
            font-family: 'Kalam', cursive;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
            background: linear-gradient(45deg, #90EE90, #98FB98);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #FFB6C1, #FF69B4);
            border-color: rgba(255, 20, 147, 0.3);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(45deg, #FF69B4, #FFB6C1);
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .title {
                font-size: 2.8rem;
            }
            
            .reaction-box {
                width: 250px;
                height: 160px;
                font-size: 1.1rem;
            }
            
            .reaction-icon {
                font-size: 2.5rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                width: 95%;
            }
            
            .game-area {
                padding: 25px;
            }
            
            .reaction-box {
                width: 200px;
                height: 140px;
                font-size: 1rem;
            }
            
            .reaction-icon {
                font-size: 2rem;
            }
            
            .result-main {
                font-size: 2rem;
            }
        }
        
        /* Performance tips */
        .tips {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            padding: 20px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
        }
        
        .tips-title {
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            color: #2F4F2F;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .tip-item {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            font-size: 0.9rem;
            color: #2F4F2F;
        }
        
        .tip-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
            display: block;
        }
    </style>
</head>
<body>
    <!-- Floating background elements -->
    <div class="floating-elements" id="floatingElements"></div>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="title">‚ö° Spirit Reflexes</h1>
            <p class="subtitle">Test your connection to the forest spirits</p>
            
            <div class="instructions">
                üå∏ <strong>How to commune with the spirits:</strong><br>
                Wait for the mystical glow to appear, then click as quickly as your spirit allows!<br>
                üåô Red moon means patience... üå± Green light means react!
            </div>
        </div>
        
        <!-- Game Area -->
        <div class="game-area">
            <div class="reaction-box waiting" id="reactionBox">
                <div class="reaction-icon">üåô</div>
                <div class="reaction-text">Touch to awaken the spirits</div>
            </div>
            
            <div class="results" id="results" style="display: none;">
                <div class="result-main" id="resultTime">0ms</div>
                <div class="result-message" id="resultMessage">The spirits whisper...</div>
            </div>
        </div>
        
        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">‚ö°</div>
                <div class="stat-value" id="lastTime">--</div>
                <div class="stat-label">Last Whisper</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üåü</div>
                <div class="stat-value" id="bestTime">--</div>
                <div class="stat-label">Fastest Spirit</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üå∏</div>
                <div class="stat-value" id="avgTime">--</div>
                <div class="stat-label">Spirit Harmony</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ü¶ã</div>
                <div class="stat-value" id="attempts">0</div>
                <div class="stat-label">Attempts</div>
            </div>
        </div>
        
        <!-- History -->
        <div class="history">
            <div class="history-title">üåø Recent Spirit Connections</div>
            <div class="history-list" id="historyList">
                <div style="color: #556B2F; font-style: italic;">No connections yet...</div>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="controls">
            <button class="btn" id="resetBtn">üîÑ Clear Sacred Records</button>
            <button class="btn btn-secondary" id="newGameBtn">üå± New Awakening</button>
        </div>
        
        <!-- Performance Tips -->
        <div class="tips">
            <div class="tips-title">üßò Wisdom from the Forest Spirits</div>
            <div class="tips-grid">
                <div class="tip-item">
                    <span class="tip-icon">üëÅÔ∏è</span>
                    Keep your gaze centered on the mystical orb
                </div>
                <div class="tip-item">
                    <span class="tip-icon">üå¨Ô∏è</span>
                    Breathe deeply and stay relaxed
                </div>
                <div class="tip-item">
                    <span class="tip-icon">üéØ</span>
                    Practice brings harmony with nature
                </div>
                <div class="tip-item">
                    <span class="tip-icon">üåô</span>
                    Find a peaceful environment
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            isWaiting: false,
            isReady: false,
            startTime: 0,
            reactionTimes: JSON.parse(localStorage.getItem('spiritReflexTimes') || '[]'),
            attempts: parseInt(localStorage.getItem('spiritReflexAttempts') || '0')
        };
        
        // DOM elements
        const reactionBox = document.getElementById('reactionBox');
        const results = document.getElementById('results');
        const resultTime = document.getElementById('resultTime');
        const resultMessage = document.getElementById('resultMessage');
        const lastTime = document.getElementById('lastTime');
        const bestTime = document.getElementById('bestTime');
        const avgTime = document.getElementById('avgTime');
        const attempts = document.getElementById('attempts');
        const historyList = document.getElementById('historyList');
        const resetBtn = document.getElementById('resetBtn');
        const newGameBtn = document.getElementById('newGameBtn');
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            createFloatingElements();
            updateStatistics();
            updateHistory();
            setupEventListeners();
        });
        
        function createFloatingElements() {
            const container = document.getElementById('floatingElements');
            
            // Create floating petals
            for (let i = 0; i < 15; i++) {
                const petal = document.createElement('div');
                petal.className = 'petal';
                petal.style.left = Math.random() * 100 + '%';
                petal.style.animationDelay = Math.random() * 15 + 's';
                petal.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(petal);
            }
            
            // Create sparkles
            for (let i = 0; i < 12; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 3 + 's';
                container.appendChild(sparkle);
            }
            
            // Create fireflies
            for (let i = 0; i < 8; i++) {
                const firefly = document.createElement('div');
                firefly.className = 'firefly';
                firefly.style.left = Math.random() * 100 + '%';
                firefly.style.top = Math.random() * 100 + '%';
                firefly.style.animationDelay = Math.random() * 8 + 's';
                container.appendChild(firefly);
            }
        }
        
        function setupEventListeners() {
            reactionBox.addEventListener('click', handleReactionClick);
            resetBtn.addEventListener('click', resetStats);
            newGameBtn.addEventListener('click', newGame);
        }
        
        function handleReactionClick() {
            if (gameState.isReady) {
                // Calculate reaction time
                const reactionTime = Math.round(performance.now() - gameState.startTime);
                recordReaction(reactionTime);
                showResult(reactionTime);
                resetGame();
            } else if (gameState.isWaiting) {
                // Too early!
                showTooEarly();
                resetGame();
            } else {
                // Start the game
                startGame();
            }
        }
        
        function startGame() {
            gameState.isWaiting = true;
            gameState.isReady = false;
            
            // Update visual state
            reactionBox.className = 'reaction-box waiting';
            reactionBox.innerHTML = `
                <div class="reaction-icon">üåô</div>
                <div class="reaction-text">Wait for the forest spirits...</div>
            `;
            
            results.style.display = 'none';
            
            // Random delay between 2-5 seconds
            const delay = Math.random() * 3000 + 2000;
            
            setTimeout(() => {
                if (gameState.isWaiting) {
                    showReady();
                }
            }, delay);
        }
        
        function showReady() {
            gameState.isWaiting = false;
            gameState.isReady = true;
            gameState.startTime = performance.now();
            
            reactionBox.className = 'reaction-box ready';
            reactionBox.innerHTML = `
                <div class="reaction-icon">üåü</div>
                <div class="reaction-text">The spirits glow! Click now!</div>
            `;
        }
        
        function showTooEarly() {
            reactionBox.className = 'reaction-box too-early';
            reactionBox.innerHTML = `
                <div class="reaction-icon">‚ö†Ô∏è</div>
                <div class="reaction-text">Too eager! The spirits flee...</div>
            `;
            
            // Show message
            results.style.display = 'block';
            resultTime.textContent = '‚ùå';
            resultMessage.textContent = 'Patience, young spirit seeker...';
            
            setTimeout(resetGame, 2000);
        }
        
        function recordReaction(time) {
            gameState.reactionTimes.push(time);
            gameState.attempts++;
            
            // Keep only last 50 times
            if (gameState.reactionTimes.length > 50) {
                gameState.reactionTimes.shift();
            }
            
            // Save to localStorage
            localStorage.setItem('spiritReflexTimes', JSON.stringify(gameState.reactionTimes));
            localStorage.setItem('spiritReflexAttempts', gameState.attempts.toString());
        }
        
        function showResult(time) {
            results.style.display = 'block';
            resultTime.textContent = time + 'ms';
            
            // Determine message based on performance
            let message = '';
            let icon = '';
            
            if (time < 150) {
                message = 'Lightning spirit! Incredible reflexes! ‚ö°';
                icon = 'üåü';
            } else if (time < 200) {
                message = 'Swift as the wind! Excellent connection! üå™Ô∏è';
                icon = 'ü¶ã';
            } else if (time < 250) {
                message = 'Good harmony with the forest spirits! üåø';
                icon = 'üå∏';
            } else if (time < 300) {
                message = 'The spirits hear you, practice brings wisdom! üå±';
                icon = 'üçÉ';
            } else {
                message = 'The ancient spirits move slowly, keep practicing! üåô';
                icon = 'üêå';
            }
            
            resultMessage.innerHTML = icon + ' ' + message;
            
            updateStatistics();
            updateHistory();
        }
        
        function resetGame() {
            setTimeout(() => {
                gameState.isWaiting = false;
                gameState.isReady = false;
                
                reactionBox.className = 'reaction-box waiting';
                reactionBox.innerHTML = `
                    <div class="reaction-icon">üåô</div>
                    <div class="reaction-text">Touch to awaken the spirits</div>
                `;
            }, 2000);
        }
        
        function newGame() {
            gameState.isWaiting = false;
            gameState.isReady = false;
            
            reactionBox.className = 'reaction-box waiting';
            reactionBox.innerHTML = `
                <div class="reaction-icon">üåô</div>
                <div class="reaction-text">Touch to awaken the spirits</div>
            `;
            
            results.style.display = 'none';
        }
        
        function updateStatistics() {
            const times = gameState.reactionTimes;
            
            // Update attempts
            attempts.textContent = gameState.attempts;
            
            if (times.length === 0) {
                lastTime.textContent = '--';
                bestTime.textContent = '--';
                avgTime.textContent = '--';
                return;
            }
            
            // Last time
            lastTime.textContent = times[times.length - 1] + 'ms';
            
            // Best time
            const best = Math.min(...times);
            bestTime.textContent = best + 'ms';
            
            // Average time
            const avg = Math.round(times.reduce((a, b) => a + b, 0) / times.length);
            avgTime.textContent = avg + 'ms';
        }
        
        function updateHistory() {
            const times = gameState.reactionTimes;
            
            if (times.length === 0) {
                historyList.innerHTML = '<div style="color: #556B2F; font-style: italic;">No connections yet...</div>';
                return;
            }
            
            // Show last 10 times
            const recentTimes = times.slice(-10).reverse();
            historyList.innerHTML = recentTimes.map((time, index) => {
                let className = 'history-item';
                if (time === Math.min(...times)) {
                    className += ' best';
                }
                return `<div class="${className}">${time}ms</div>`;
            }).join('');
        }
        
        function resetStats() {
            if (confirm('üå∏ Are you sure you want to clear all sacred records?')) {
                gameState.reactionTimes = [];
                gameState.attempts = 0;
                
                localStorage.removeItem('spiritReflexTimes');
                localStorage.removeItem('spiritReflexAttempts');
                
                updateStatistics();
                updateHistory();
                newGame();
                
                // Show confirmation
                results.style.display = 'block';
                resultTime.textContent = 'üå±';
                resultMessage.textContent = 'Sacred records cleared. Begin anew!';
                
                setTimeout(() => {
                    results.style.display = 'none';
                }, 3000);
            }
        }
        
        // Keyboard support
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault();
                handleReactionClick();
            }
        });
        
        // Prevent context menu on the reaction box
        reactionBox.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        
        // Handle visibility change (tab switching)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && (gameState.isWaiting || gameState.isReady)) {
                resetGame();
            }
        });
        
        // Add special effects for excellent performance
        function createCelebrationEffect() {
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'absolute';
                particle.style.width = '6px';
                particle.style.height = '6px';
                particle.style.background = '#FFD700';
                particle.style.borderRadius = '50%';
                particle.style.pointerEvents = 'none';
                particle.style.zIndex = '1000';
                
                const boxRect = reactionBox.getBoundingClientRect();
                particle.style.left = (boxRect.left + boxRect.width/2) + 'px';
                particle.style.top = (boxRect.top + boxRect.height/2) + 'px';
                
                document.body.appendChild(particle);
                
                // Animate particle
                const angle = (i * 18) * Math.PI / 180;
                const distance = 100 + Math.random() * 50;
                const endX = boxRect.left + boxRect.width/2 + Math.cos(angle) * distance;
                const endY = boxRect.top + boxRect.height/2 + Math.sin(angle) * distance;
                
                particle.animate([
                    { 
                        transform: 'scale(0) rotate(0deg)',
                        opacity: 1,
                        left: (boxRect.left + boxRect.width/2) + 'px',
                        top: (boxRect.top + boxRect.height/2) + 'px'
                    },
                    { 
                        transform: 'scale(1) rotate(180deg)',
                        opacity: 1,
                        left: endX + 'px',
                        top: endY + 'px',
                        offset: 0.7
                    },
                    { 
                        transform: 'scale(0) rotate(360deg)',
                        opacity: 0,
                        left: endX + 'px',
                        top: endY + 'px'
                    }
                ], {
                    duration: 1500,
                    easing: 'ease-out'
                });
                
                setTimeout(() => {
                    if (document.body.contains(particle)) {
                        document.body.removeChild(particle);
                    }
                }, 1500);
            }
        }
        
        // Enhanced result showing with effects
        function showResult(time) {
            results.style.display = 'block';
            resultTime.textContent = time + 'ms';
            
            // Determine message based on performance
            let message = '';
            let icon = '';
            let shouldCelebrate = false;
            
            if (time < 150) {
                message = 'Lightning spirit! Incredible reflexes! ‚ö°';
                icon = 'üåü';
                shouldCelebrate = true;
                // Add special glow effect to the result
                resultTime.style.color = '#FFD700';
                resultTime.style.textShadow = '0 0 10px #FFD700';
            } else if (time < 200) {
                message = 'Swift as the wind! Excellent connection! üå™Ô∏è';
                icon = 'ü¶ã';
                resultTime.style.color = '#90EE90';
                resultTime.style.textShadow = '0 0 5px #90EE90';
            } else if (time < 250) {
                message = 'Good harmony with the forest spirits! üåø';
                icon = 'üå∏';
                resultTime.style.color = '#2F4F2F';
                resultTime.style.textShadow = 'none';
            } else if (time < 300) {
                message = 'The spirits hear you, practice brings wisdom! üå±';
                icon = 'üçÉ';
                resultTime.style.color = '#556B2F';
                resultTime.style.textShadow = 'none';
            } else {
                message = 'The ancient spirits move slowly, keep practicing! üåô';
                icon = 'üêå';
                resultTime.style.color = '#8B4513';
                resultTime.style.textShadow = 'none';
            }
            
            resultMessage.innerHTML = icon + ' ' + message;
            
            // Trigger celebration effect for excellent times
            if (shouldCelebrate) {
                setTimeout(createCelebrationEffect, 500);
            }
            
            updateStatistics();
            updateHistory();
        }
        
        // Add pulse animation to waiting state
        function addWaitingPulse() {
            if (gameState.isWaiting) {
                reactionBox.style.animation = 'pulse 2s ease-in-out infinite';
            }
        }
        
        // Enhanced start game with better visual feedback
        function startGame() {
            gameState.isWaiting = true;
            gameState.isReady = false;
            
            // Update visual state with enhanced animation
            reactionBox.className = 'reaction-box waiting';
            reactionBox.innerHTML = `
                <div class="reaction-icon">üåô</div>
                <div class="reaction-text">Wait for the forest spirits...</div>
            `;
            
            results.style.display = 'none';
            
            // Add gentle pulsing while waiting
            reactionBox.style.animation = 'pulse 2s ease-in-out infinite';
            
            // Random delay between 2-5 seconds
            const delay = Math.random() * 3000 + 2000;
            
            setTimeout(() => {
                if (gameState.isWaiting) {
                    showReady();
                }
            }, delay);
        }
        
        // Enhanced ready state
        function showReady() {
            gameState.isWaiting = false;
            gameState.isReady = true;
            gameState.startTime = performance.now();
            
            // Remove waiting animation and add ready state
            reactionBox.style.animation = '';
            reactionBox.className = 'reaction-box ready';
            reactionBox.innerHTML = `
                <div class="reaction-icon">üåü</div>
                <div class="reaction-text">The spirits glow! Click now!</div>
            `;
            
            // Add glowing effect
            reactionBox.style.boxShadow = '0 10px 30px rgba(34, 139, 34, 0.5), 0 0 50px rgba(144, 238, 144, 0.8)';
        }
        
        // Add CSS for pulse animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0%, 100% { 
                    transform: scale(1);
                    opacity: 1;
                }
                50% { 
                    transform: scale(1.02);
                    opacity: 0.8;
                }
            }
            
            .history-item.best {
                background: linear-gradient(45deg, #FFD700, #FFA500);
                border-color: #FF8C00;
                color: #8B4513;
                font-weight: 700;
                position: relative;
            }
            
            .history-item.best::after {
                content: 'üëë';
                position: absolute;
                top: -5px;
                right: -5px;
                font-size: 0.8rem;
            }
            
            .stat-card.highlight {
                background: linear-gradient(45deg, #FFD700, #FFA500);
                border-color: #FF8C00;
                animation: highlight 2s ease-in-out;
            }
            
            @keyframes highlight {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.05); }
            }
        `;
        document.head.appendChild(style);
        
        // Enhanced history update with best time highlighting
        function updateHistory() {
            const times = gameState.reactionTimes;
            
            if (times.length === 0) {
                historyList.innerHTML = '<div style="color: #556B2F; font-style: italic;">No connections yet...</div>';
                return;
            }
            
            const bestOverall = Math.min(...times);
            
            // Show last 10 times
            const recentTimes = times.slice(-10).reverse();
            historyList.innerHTML = recentTimes.map((time, index) => {
                let className = 'history-item';
                if (time === bestOverall) {
                    className += ' best';
                }
                return `<div class="${className}">${time}ms</div>`;
            }).join('');
        }
        
        // Enhanced statistics update with highlighting
        function updateStatistics() {
            const times = gameState.reactionTimes;
            
            // Update attempts
            attempts.textContent = gameState.attempts;
            
            if (times.length === 0) {
                lastTime.textContent = '--';
                bestTime.textContent = '--';
                avgTime.textContent = '--';
                return;
            }
            
            const lastReactionTime = times[times.length - 1];
            
            // Last time
            lastTime.textContent = lastReactionTime + 'ms';
            
            // Best time with highlighting if it's a new record
            const best = Math.min(...times);
            bestTime.textContent = best + 'ms';
            
            // Highlight if new best
            if (lastReactionTime === best && times.length > 1) {
                bestTime.parentElement.classList.add('highlight');
                setTimeout(() => {
                    bestTime.parentElement.classList.remove('highlight');
                }, 2000);
            }
            
            // Average time
            const avg = Math.round(times.reduce((a, b) => a + b, 0) / times.length);
            avgTime.textContent = avg + 'ms';
        }
        
        // Add sound effects (optional, using Web Audio API)
        function createAudioContext() {
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                return audioCtx;
            } catch (e) {
                return null;
            }
        }
        
        function playTone(frequency, duration = 200, type = 'sine') {
            const audioCtx = createAudioContext();
            if (!audioCtx) return;
            
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration / 1000);
            
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + duration / 1000);
        }
        
        // Add subtle sound effects to interactions
        reactionBox.addEventListener('mouseenter', () => {
            if (!gameState.isWaiting && !gameState.isReady) {
                playTone(220, 100, 'sine'); // Soft hover sound
            }
        });
        
        // Play sounds for different game states
        function showReady() {
            gameState.isWaiting = false;
            gameState.isReady = true;
            gameState.startTime = performance.now();
            
            // Remove waiting animation and add ready state
            reactionBox.style.animation = '';
            reactionBox.className = 'reaction-box ready';
            reactionBox.innerHTML = `
                <div class="reaction-icon">üåü</div>
                <div class="reaction-text">The spirits glow! Click now!</div>
            `;
            
            // Add glowing effect
            reactionBox.style.boxShadow = '0 10px 30px rgba(34, 139, 34, 0.5), 0 0 50px rgba(144, 238, 144, 0.8)';
            
            // Play ready sound
            playTone(440, 150, 'triangle');
        }
        
        // Performance optimization: reduce floating elements on mobile
        function createFloatingElements() {
            const container = document.getElementById('floatingElements');
            const isMobile = window.innerWidth <= 768;
            
            // Create floating petals (fewer on mobile)
            const petalCount = isMobile ? 8 : 15;
            for (let i = 0; i < petalCount; i++) {
                const petal = document.createElement('div');
                petal.className = 'petal';
                petal.style.left = Math.random() * 100 + '%';
                petal.style.animationDelay = Math.random() * 15 + 's';
                petal.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(petal);
            }
            
            // Create sparkles (fewer on mobile)
            const sparkleCount = isMobile ? 6 : 12;
            for (let i = 0; i < sparkleCount; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 3 + 's';
                container.appendChild(sparkle);
            }
            
            // Create fireflies (fewer on mobile)
            const fireflyCount = isMobile ? 4 : 8;
            for (let i = 0; i < fireflyCount; i++) {
                const firefly = document.createElement('div');
                firefly.className = 'firefly';
                firefly.style.left = Math.random() * 100 + '%';
                firefly.style.top = Math.random() * 100 + '%';
                firefly.style.animationDelay = Math.random() * 8 + 's';
                container.appendChild(firefly);
            }
        }
    </script>
</body>
</html>
    </script>
</body>
</html>